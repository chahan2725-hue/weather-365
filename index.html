<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>災害情報サイト</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  .section { display: none; margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
  button { margin-right: 10px; margin-bottom: 10px; }
  pre { white-space: pre-wrap; }
</style>
</head>
<body>
<h1>災害情報</h1>
<button onclick="showSection('earthquake')">地震情報</button>
<button onclick="showSection('eew')">緊急地震速報（EEW）</button>

<div id="earthquake" class="section"><pre>読み込み中...</pre></div>
<div id="eew" class="section"><pre>読み込み中...</pre></div>

<script>
// --------------------
// 表示切替
// --------------------
function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  document.getElementById(id).style.display = 'block';
}

// --------------------
// 補助関数（scale/depthなど）
function scaleToText(scale) {
  if (scale == null || scale < 0) return "不明";
  const map = {10:'1',20:'2',30:'3',40:'4',45:'5-',50:'5+',55:'6-',60:'6+',70:'7'};
  return map[scale] || '不明';
}

function depthToText(depth) {
  if (depth == null || depth < 0) return "不明";
  if (depth === 0) return "ごく浅い";
  return depth + "km";
}

// --------------------
// 地震情報取得
// --------------------
async function loadEarthquake() {
  const container = document.getElementById('earthquake').querySelector('pre');
  try {
    const res = await fetch("https://api.p2pquake.net/v2/history?codes=551&limit=5");
    const data = await res.json();
    if (!data || data.length === 0) {
      container.textContent = "地震情報なし";
      return;
    }

    let html = "";
    data.slice(0,5).forEach(item => {
      const eq = item.earthquake;
      const h = eq.hypocenter;
      const place = h.name || "(震源地不明)";
      const maxScale = scaleToText(eq.maxScale);
      const magnitude = (h.magnitude != null && h.magnitude >= 0) ? h.magnitude.toFixed(1) : "不明";
      const depth = depthToText(h.depth);

      html += `《地震情報》\n`;
      html += `震源地: ${place}\n`;
      html += `最大震度: ${maxScale}\n`;
      html += `マグニチュード: ${magnitude}\n`;
      html += `深さ: ${depth}\n\n`;
    });

    container.textContent = html.trim();
  } catch(e) {
    container.textContent = "地震情報取得エラー";
    console.error(e);
  }
}

// --------------------
// EEW取得
// --------------------
async function loadEew() {
  const container = document.getElementById('eew').querySelector('pre');
  try {
    const res = await fetch("https://api.wolfx.jp/jma_eew.json");
    const data = await res.json();
    if (!data || data.isTraining) {
      container.textContent = "EEW情報なし";
      return;
    }

    let html = `◆${data.Title}◆\n`;
    html += data.isFinal ? "＊最終報\n" : `＊第${data.Serial}報\n`;

    if (data.isCancel) html += "\nこの緊急地震速報はキャンセルされました。\n";

    const hypocenter = data.Hypocenter ?? "震源地不明";
    const maxInt = data.MaxIntensity ?? "不明";
    const magnitude = data.Magunitude ?? "不明";
    const depth = data.Depth ?? "不明";

    html += `${hypocenter} で地震\n`;
    html += `推定最大震度 ${maxInt}\n`;
    html += `マグニチュード: ${magnitude}\n`;
    html += `震源の深さ: ${depth}km\n`;

    if (data.WarnArea && data.WarnArea.length > 0) {
      const areas = data.WarnArea.map(a => a.Chiiki ?? a.chiiki).join("、");
      html += `\n【対象地域】\n${areas}\n`;
    }

    container.textContent = html.trim();
  } catch(e) {
    container.textContent = "EEW情報取得エラー";
    console.error(e);
  }
}

// 初回ロード
loadEarthquake();
loadEew();
</script>
</body>
</html>
